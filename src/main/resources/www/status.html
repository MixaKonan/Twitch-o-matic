<!doctype html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>

    <!-- Bootstrap CSS -->
    <link rel='stylesheet' href='bootstrap.min.css' crossorigin='anonymous'
          integrity='sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO'>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src='jquery-3.3.1.min.js' crossorigin='anonymous'
            integrity='sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8='></script>
    <script src='popper.min.js' crossorigin='anonymous'
            integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49'></script>
    <script src='bootstrap.min.js' crossorigin='anonymous'
            integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy'></script>
    <title>Status</title>
</head>
<body>
<div class='container'>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="index.html">Management</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Management</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#">Status</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class='container p-3'>
        <table class='table table-bordered'>
            <thead class='thead-dark'>
            <tr>
                <th scope='col' width='auto'>uuid</th>
                <th scope='col' width='auto'>vodId</th>
                <th scope='col' width='auto'>Started by</th>
                <th scope='col' width='auto'>Date</th>
                <th scope='col' width='auto'>State</th>
            </tr>
            </thead>
            <tbody id='table'></tbody>
        </table>
    </div>
</div>
<script type="application/javascript">
    var path = window.location.origin+"/status_api/";

    function write() {
        $("#table").empty();
        $.getJSON(path + "status_list", function (data) {
            data.sort(function (a, b) {
                var first = new Date(a["date"].replace('T', ' ').replace('Z', ''));
                var second = new Date(b["date"].replace('T', ' ').replace('Z', ''));
                return (second > first) ? 1 : (second < first) ? -1 : 0;
            });
            jQuery.each(data, function (index, value) {
                $("#table").append(
                    "<tr>" +
                    "<th scope='row'>" + value.uuid + "</th>" +
                    "<td>" + value.vodId + "</td>" +
                    "<td>" + value.startedBy + "</td>" +
                    "<td>" + value.date.replace('T', ' ').replace('Z', '') + "</td>" +
                    "<td class='bg-" + background(value.state) + "'>" + value.state + "</td>" +
                    "</tr>"
                );
            });
        });
        setTimeout(function () {
            write();
        }, 10000);
    }


    function background(value) {
        switch (value) {
            case "INITIALIZE":
                return "warning";
            case "RUNNING":
                return "info";
            case "COMPLETE":
                return "success";
            case "ERROR":
                return "danger";
        }
    }

    write();

</script>
</body>
</html>
